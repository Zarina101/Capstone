---
title: "Data Wrangling and EDA"
author: "Ulita Gilbert"
date: "12/03/2021"
output:
  html_document:
    fig_caption: yes
    number_sections: yes
    toc: yes
  pdf_document:
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#import libraries

library(tidyverse)
library(ggplot2)
library(readxl)
library (janitor)
library(skimr)
library(plotly)
library(scales)
library(httr)
library(jsonlite)
library(lubridate)
```

# Data Dictionary

For the purposes of this Project the following variables and definitions are important.

The population in this dataset is the incoming cohort of students in Fall of 2019 and 2020. These students are first time degree or certificate seekers and have no prior tertiary education. They may have earned AP credits in highschool.

**Fall2019** refers to the incoming freshman cohort in Fall2019. This is term year 2020.  
**Fall2020** refers to the incoming freshman cohort in Fall2020. This is term year 2021.

**Variables of Interest:** 
**term year ** Incoming students in Fall2019 are assigned to term year 2020. Incoming students in Fall 2020 are assigned to term year 2021.  
**hours_earned:** refers to credit hours the student has earned in their first Fall semester ( this can include credits earned in Summer school second session- Summer 1 and AP credits earned in high school).  
**hours_attempted:** refers to credit  and non credit hours the student has attempted in their first Fall semester  ( this may include credits attempted in Summerschool second session - Summer 1).  
**full_part:** is the student full-time (FT) or part-time (PT). Part time students are registered in less than 12 credit hours. Full-time students take at least 12 credits.
**major:** degree programme student is registered for or certificate&LR ( letter of recommendation.) All certificates and letters of recommendations have been grouped together.   
**hours_earned_rate:** Ratio of hours_earned/hours_attempted 
**age:** Age of student at start of program.  
**race:** Racial classification of student.
**sex:** Gender classification of student.
**high_school:** Name of highschool student graduted from. Public High schools in Montgomery county are classified as MCPS.
**pell:** Whether the student receives a pell grant or not. 




# Data Wrangling

## Import Data
```{r}
#import data for Fall 2016 to Fall 2020
# set directory
setwd('/Users/ulita/Documents/CAPSTONE205/Capstone/Capstone_Data/Raw_Data')

initial_df_2019<-read_xlsx("FTEIC F19.xlsx")
initial_df_2020<-read_xlsx("FTEIC F20.xlsx")

```

Read in files from dataMontgomery
```{r,message=FALSE}
#Access list of all highschools in Montgomery County. This will be used to filter highschools in student dataset.

r <- GET('https://data.montgomerycountymd.gov/resource/bfcv-pyzh.json')

#glimpse(r)
#content(r, "text")

jsonRespText <- content(r, as="text")
jsonRespParsed <- content(r, as="parsed")
#jsonRespParsed

df_MC <- fromJSON(jsonRespText)
#head(df_MC)
#class(df_MC)
df_MCPS <- as_tibble(df_MC)

```



## Create Dataframe

```{r}
 #create dataframe to compare credits in Fall 2019 and Fall 2020 :    df_credits 
df_initial<- bind_rows(initial_df_2019,initial_df_2020)

head(df_initial)
```


## Select Columns of Interest & Format Names
```{r}

#clean names using janitor package
df_initial<-df_initial %>%
             clean_names()

#drop columns not interested in

df_initial<-df_initial %>%
            dplyr::select(c(1:20))

# rename columns to make it user friendly
df_initial<-df_initial %>%
            rename("age"= "age_at_start", "race"= "ipeds_race_desc", 'summer1'= "term_year1_10", 'fall'='term_year1_20')

```  


## Overview of Data
```{r}
# summary statistics of dataframing using function skimr creates a table of summary statistics of all variables in the dataframe
skim(df_initial)
```

There are 18 variables and 7519 rows of data. Each row of data represents 1 student. 
There are 3931 rows of data for Fall2019 and 3588 rows of data for Fall2020.
Need to change the data types for hours_attempted and hours_earned to numeric. u_number should be a charater. 
Most of the missing values are in camp_code. For the purposes of this exercise, this variable is not important.
There are also 87 missing values in hours attempted and hours earned. As these two are the variables of interest and GPA are of interest, I will drop the rows in these variables with missing values.

## Change Datatypes
```{r}
# Change datatypes
df_initial$hours_attempted<- as.integer(df_initial$hours_attempted)
df_initial$hours_earned<- as.integer(df_initial$hours_earned)
df_initial$mc_gpa<- as.double(df_initial$mc_gpa)
df_initial$u_number<- as.character(df_initial$u_number)
df_initial$zip<- as.character(df_initial$zip)

#drop missing values in hours_attempted, hours_earned and mc_gap

df_initial <- df_initial %>%
              drop_na(hours_attempted,hours_earned)

```

Summarise data again
```{r}
skim(df_initial)
```

After removing the missing values in hours_earned and hours_attempted. There are 8 missing values in Fall. Closer inspection shows that these 8 students have a GPA of 0 even though there are hours attempted and hours earned. I will remove these students. 
```{r}
# remove students whose Fall term is NA

df_initial <- df_initial%>%
              filter(., !is.na(fall))
              
skim(df_initial)

```


## Missing Values and data Anomalies

```{r}

df_initial%>% group_by(term_year,full_part)%>%
                      count(hours_attempted==0)

```
Term year 2020: There are 3 full time and 27 part time students who attempted zero hours.
Term year 2021: There are 17 part time students who attempted zero hours.
These 47 observations will be dropped.

```{r}
# remove students who attempted 0 hours

df_initial <- df_initial%>%
              filter(., hours_attempted != 0)
              
skim(df_initial)

```



Check missing values in variable major
```{r}

#check majors list for undeclared and missing values.

df_initial%>% count(major)
dim(df_initial)
```

There are 72 students with undeclared majors. 16 students with majors listed as 0 and 33 listed as NA.
Due to privacy reasons, students have been grouped so as not to identify individual students. Degree Major groupings with less than 10 students have been listed as NA or 0. At this point in time I will not remove these data points, because for the purposes of this study, Major names are not required. 
I will change the NA in major to 'Field2' and the 0 to Field1.
Students enrolled for a certificate or Letter of Recommendation have been grouped togther irrespective of field.


# Initial Data Analysis

There are 221 Certificate & LR students in the initial dataset. I will drop these non-degree programmes
and focus on degree majors only.


Create dataframe with degrees only.
I have retained the majors grouped as NA.
```{r}

#remove certificates, NA refers to degree majors which have not been named to protect student privacy.
df_Degrees<-subset(df_initial, major!="Certificate & LR")
df_Degrees%>%count(major)
```

save dataframe Degrees
```{r}
write.csv(df_Degrees,'df_Degrees.csv')

```

## Demographics of Degree Seeking Students


### Full time versus Part-time Degree Students
```{r}
#count number of full time versus part-time degree students.

df_Degrees%>% group_by(term_year)%>%
              count(full_part)


```

```{r}
# change in overall student population from 2020 to 2021

df_Degrees%>%
          group_by(term_year,full_part)%>%
          count(full_part)%>%
          group_by(term_year)%>%
          mutate(total_pop =sum(n))%>%
          group_by(full_part)%>%
          arrange(term_year,.by_group=TRUE)%>%
          mutate(pct_change= (n-lag(n))/lag(n)*100) 
```

```{r}
# decrease in total student population
((2251+1606)-(2147+1373))/(2251+1606)*100
```
Degree Seeking students:
There was an 8.7% decrease in the incoming cohort ( part time and full time) size from 2020 to 2021. 
In term year 2020, there were 2222 full time degree seeking students and 1527 part time degree seeking students.
In term year 2021, there were 2088 full time degree seeking students and 1286 part time degree seeking students.
There is a 6 % drop in full time enrollment from 2020 to 2021. There is a 15.78 % drop in part time enrollment from 2020 to 2021.


Frequency of Students Part time versus Full time: 2020 vs 2021
```{r}

# Number of students part time abnd full time  2020 vs 2021
ggplot(data=df_Degrees, aes(x=full_part, fill=full_part)) +
      geom_bar() +
      geom_text(stat='count', aes(label=..count..), vjust=2,size=3)+
      facet_wrap(~term_year)+
      ggtitle("Number of Students Full time versus Part time")+
      ylab('Frequency')+
      xlab("")+
      theme(axis.text.x=element_blank(),strip.background = element_blank(),panel.grid = element_blank())
   
```


Proportion of Students Full time versus Part time: 2020 vs 2021
```{r}

df_Degrees %>% 
    group_by(term_year) %>% 
    count(full_part) %>% 
    mutate(prop = n/sum(n)) %>% 
    ggplot(aes(x = full_part, y = prop)) +
    geom_col(aes(fill = full_part), position = "dodge") +
    geom_text(aes(label = scales::percent(prop), 
                  y = prop, 
                  group = full_part),
              position = position_dodge(width = 0.9),
              vjust = 2,size=3)+
   facet_wrap(~term_year)+
      ggtitle("Proportion of Students Full time versus Part time")+
      ylab('Percentage')+
      xlab("")+
      theme(axis.text.x=element_blank(),strip.background = element_blank(),panel.grid = element_blank())
   

```

Approximately 3/5 of students in each term year are full time and 2/5 are part time.

### Race

Count of Race Groups
```{r}
ggplot(data=df_Degrees, aes(x=race, fill=race)) +
      geom_bar() +
      geom_text(stat='count', aes(label=..count..), vjust=0,size=3)+
      facet_wrap(~term_year + full_part)+
      theme(axis.text.x=element_blank(),strip.background = element_blank(),panel.grid = element_blank())+
      ggtitle("Number of Students per a Race Group")+
      xlab("Race")+
      ylab("Frequency")


```
Percentage of each race group in Student Population
```{r}
df_Degrees %>% 
    group_by(term_year,full_part) %>% 
    count(race) %>% 
    mutate(prop = n/sum(n)) %>% 
    ggplot(aes(x = race, y = prop)) +
    geom_col(aes(fill = race), position = "dodge") +
    geom_text(aes(label = scales::percent(prop,0.1), 
                  y = prop, 
                  group = race),
              position = position_dodge(width = 0.9),
              vjust = 0,size=3)+
    facet_wrap(~term_year + full_part)+
      ggtitle("Race Proportion of Students: Full time versus Part time")+
      ylab('Proportion ')+
      xlab("")+
      theme(axis.text.x=element_blank(),strip.background = element_blank(),panel.grid = element_blank())
   

```
Hispanic students form the largest proportion in the full time and part time student populations, followed by African American, White, Asian and Foreign students. 


```{r}

df_Degrees%>% 
  filter(full_part=='FT')%>%
    group_by(race,term_year)%>%
   tally() 

```

Full time student: Change in enrollment from 2020 to 2021 based on Race
```{r}
# calculate percentage change in full time student enrollment from 2020 to 2021 by  race

df_Degrees%>%
          filter(full_part=="FT")%>%
          group_by(term_year,race)%>%
          count(race)%>%
          group_by(race)%>%
          arrange(term_year,.by_group=TRUE)%>%
          mutate(pct_change= (n-lag(n))/lag(n)*100) 
```
Full time students: In 2021 there was a 10.57% increase of Hispanic students when compared to 2020.The was a 12.83 % decrease in African American Students,
13.84 % decrease in Asian Students, a 7,54% decrease in white students and a 17.81% decrease in foreign students. 


Part time student: Change in enrollment from 2020 to 2021 based on Race
```{r}

df_Degrees%>% 
  filter(full_part=='PT')%>%
    group_by(race,term_year)%>%
   tally() 

```
Part time student: Change in enrollment from 2020 to 2021 based on Race
```{r}
# calculate percentage change in part time student enrollment from 2020 to 2021 by  race

df_Degrees%>%
          filter(full_part=="PT")%>%
          group_by(term_year,race)%>%
          count(race)%>%
          group_by(race)%>%
          arrange(term_year,.by_group=TRUE)%>%
          mutate(pct_change= (n-lag(n))/lag(n)*100) 
```

Part time degree seeking students: In 2021 there was a 19.35% decrease of Hispanic part time degree seeking students when compared to 2020.
The was a 12.87 % decrease in African American Students, 23.48 % decrease in Asian Students, a 6.59% increase in white students and a 39.52% decrease in foreign students. 


### Age
Age distribution of Students Part time versus Full tim: 2020 vs 2021
```{r}

# Age distribution of students 2020 vs 2021
ggplot(data=df_Degrees, aes(x=age, fill=age)) +
      geom_bar() +
      geom_text(stat='count', aes(label=..count..), vjust=0,size=3)+
      facet_wrap(~term_year+full_part)+
      ggtitle("Age Distribution of Students: Full time versus Part time")+
      ylab('Frequency')+
      xlab("")+
      theme(axis.text.x=element_blank(),strip.background = element_blank(),panel.grid = element_blank())
   
```

Age distribution of Full time Students

```{r}
df_Degrees%>%
          filter(full_part=="FT")%>%
          group_by(term_year,age)%>%
          count(age)%>%
          group_by(term_year)%>%
          mutate(total_pop =sum(n))%>%
          group_by(age)%>%
          arrange(term_year,.by_group=TRUE)%>%
          mutate(pct_pop= (n/total_pop*100))
```

In term year 2020 and term year 2021 ,approximately 85% of the full time and part time students are between 18-20yrs.
In term year 2020, 66.86% of the part time students were between 18-20yrs and in term year 2021, 70.68% students. 

Age distribution of Part time Students
```{r}
df_Degrees%>%
          filter(full_part=="PT")%>%
          group_by(term_year,age)%>%
          count(age)%>%
          group_by(term_year)%>%
          mutate(total_pop =sum(n))%>%
          group_by(age)%>%
          arrange(term_year,.by_group=TRUE)%>%
          mutate(pct_pop= (n/total_pop*100))
```

The part time student population in term year 2020 and term year 2021 has a higher proportion of 21-24, 25-29 and 30+ and a lower proportion of under 18s than the full time student population. 


### Gender
Gender of Students 
```{r}

# Gender of students part time and full time  2020 vs 2021
ggplot(data=df_Degrees, aes(x=sex, fill=sex)) +
      geom_bar() +
      geom_text(stat='count', aes(label=..count..), vjust=1,size=3)+
      facet_wrap(~term_year+full_part)+
      ggtitle("Gender of Students: Full time versus Part time")+
      ylab('Frequency')+
      xlab("")+
      theme(axis.text.x=element_blank(),strip.background = element_blank(),panel.grid = element_blank())
   
```

Gender 0 and Gender N are unknown values, however they have not been removed from the dataset as the variables of interest are hours_attempted and hours_earned.
Some students choose not to report a gender or are transgender.This is approximately 1% of the student population.

Percentage of Full time Students by Gender
```{r}
df_Degrees%>%
          filter(full_part=="FT")%>%
          group_by(term_year,sex)%>%
          count(sex)%>%
          group_by(term_year)%>%
          mutate(total_pop =sum(n))%>%
          group_by(sex)%>%
          arrange(term_year,.by_group=TRUE)%>%
          mutate(pct_pop= (n/total_pop*100))
```

******CHECK***
In term year 2020, there was approximately 2.58% more full time male students than full time female students.
In term year 2021, there was approximately 4.89% more full time female students than full time male students.
It is evident that the full time male population have decreased more than the full time female student population in term year 2021. 


Percentage of Part time Students by Gender
```{r}
df_Degrees%>%
          filter(full_part=="PT")%>%
          group_by(term_year,sex)%>%
          count(sex)%>%
          group_by(term_year)%>%
          mutate(total_pop =sum(n))%>%
          group_by(sex)%>%
          arrange(term_year,.by_group=TRUE)%>%
          mutate(pct_pop= (n/total_pop*100))
```
***CHECK***

In term year 2020, there was approximately 5.67 % more part time female students than part time male students.
In term year 2021, there was approximately 3.42% more part time female students than part time male students.

Calculate percentage change in full time student enrollment from 2020 to 2021 by  gender
```{r}
# calculate percentage change in full time student enrollment from 2020 to 2021 by  gender

df_Degrees%>%
          filter(full_part=="FT")%>%
          filter(sex=="F"|sex =="M")%>%
          group_by(term_year,sex)%>%
          count(sex)%>%
          group_by(sex)%>%
          arrange(term_year,.by_group=TRUE)%>%
          mutate(pct_change= (n-lag(n))/lag(n)*100) 
```

Full time male students: 13.74% decline in registration
Full time female students: 2.06% increase in registration

Calculate percentage change in part time student enrollment from 2020 to 2021 by  gender
```{r}
# calculate percentage change in part time student enrollment from 2020 to 2021 by  gender

df_Degrees%>%
          filter(full_part=="PT")%>%
          filter(sex=="F"|sex =="M")%>%
          group_by(term_year,sex)%>%
          count(sex)%>%
          group_by(sex)%>%
          arrange(term_year,.by_group=TRUE)%>%
          mutate(pct_change= (n-lag(n))/lag(n)*100) 
```

Part time male students: 14.55% decrease in registration
Part time female students: 15.76% decrease in registration

Gender and Race breakdown of full time students
```{r}
# Gender and Race of full time students  2020 vs 2021

df_Degrees%>%
      filter(sex %in% c("F","M"))%>%
      filter(full_part=="FT")%>%
      ggplot(., aes(x=race, fill=race)) +
      geom_bar() +
      geom_text(stat='count', aes(label=..count..), vjust=0, size=3)+
      facet_wrap(~term_year+sex)+
      ggtitle("Gender and Race of Full time Students")+
      ylab('Frequency')+
      xlab("")+
      theme(axis.text.x=element_blank(),strip.background = element_blank(),panel.grid = element_blank())

#    theme(axis.text.x=element_blank(),strip.background = element_blank(),panel.grid = element_blank())

```

Gender and Race breakdown of part time students
```{r}
# Gender and Race of part time students 2020 vs 2021

df_Degrees %>%
      filter(sex %in% c("F","M"))%>%
      filter(full_part=="PT")%>%
      ggplot(., aes(x=race, fill=race)) +
      geom_bar() +
      geom_text(stat='count', aes(label=..count..), vjust=0,size=3)+
      facet_wrap(~term_year+sex)+
      ggtitle("Gender and Race of Part time Students")+
      ylab('Frequency')+
      xlab("")+
      theme(axis.text.x=element_blank(),strip.background = element_blank(),panel.grid = element_blank())



```

Full time Student Enrollment Percentages trend by Gender and race

```{r}
# calculate percentage change in student enrollment from 2020 to 2021 by race and gender

# create data frames with counts of full time students by race and gender
df_Degrees%>%
          filter(full_part=="FT")%>%
          filter(sex=="F"|sex =="M")%>%
          group_by(term_year,race,sex)%>%
          count(sex)%>%
          group_by(race,sex)%>%
          arrange(term_year,.by_group=TRUE)%>%
          mutate(pct_change= (n-lag(n))/lag(n)*100) 
```
Full time male students: There was a 25% decrease in asian male students, -21.23 % decrease in african american males, a 23.91 percent decrease in foreign males,
a 10.84% decrease in white males and a 2.68% increase in Hispanic males. 
Full time female students:  -2.26 % decrease in african american females, a 13.33 percent decrease in foreign females,
a 4.61% decrease in white females and a 17.63% increase in Hispanic females. 



Part time Student Enrollment Percentages trend by Gender and race
```{r}
# calculate percentage change in student enrollment from 2020 to 2021 by race and gender

# create data frames with counts of full time students by race and gender
df_Degrees%>%
          filter(full_part=="PT")%>%
          filter(sex=="F"|sex =="M")%>%
          group_by(term_year,race,sex)%>%
          count(sex)%>%
          group_by(race,sex)%>%
          arrange(term_year,.by_group=TRUE)%>%
          mutate(pct_change= (n-lag(n))/lag(n)*100) 
```


### Pell grant

```{r}

# Pell Grant
ggplot(data=df_Degrees, aes(x=pell_grant, fill=pell_grant)) +
      geom_bar() +
      geom_text(stat='count', aes(label=..count..), vjust=3, size=3)+
      facet_wrap(~term_year+full_part)+
      ggtitle("Pell grant")+
      ylab('Frequency')+
      xlab("")+
      theme(axis.text.x=element_blank(),strip.background = element_blank(),panel.grid = element_blank())
   
```

If the data is correct, no students received pell grants in term year 2021???!!!!


### Highschool

```{r}

df_Degrees%>%group_by(term_year,full_part) %>% 
        count(high_school)

```



Filter highschools  MCPS

```{r}

# high school names in student data is listed as xxx High School, whilst in MCPS it is abbreviated to HS.
# Modify MCPS dataframe to change HS to High School
# Modify MSCPS dataframe to match highschool names in MC College Student Data.

df_MCPS<- 
  df_MCPS %>%
  mutate(across("school_name", str_replace, "HS", "High School"))

```

```{r}

#Correct discrepanies in names for MCPS highschools. 
# Reason: discrepancies in names in MC College data versus Montgomery Data.
# MC College corrections : Bethesda Chevy Chase High Schl, Thomas Sprigg Wootton High Sch, Poolesville Jr-Sr High School,Colonel Zadok Magruder HS,
#Northwest HS - Germantown, Quince Orchard Sr High School,Albert Einstein HS & MC Art Cn, John F. Kennedy High School,Springbrook Sr High School,

df_MCPS<- 
  df_MCPS %>%
  mutate(across("school_name", str_replace, "Bethesda-Chevy Chase High School", "Bethesda Chevy Chase High Schl"))
df_MCPS<- 
  df_MCPS %>%
  mutate(across("school_name", str_replace, "Thomas S Wootton High School", "Thomas Sprigg Wootton High Sch"))
df_MCPS<- 
  df_MCPS %>%
  mutate(across("school_name", str_replace, "Poolesville High School", "Poolesville Jr-Sr High School"))
df_MCPS<- 
  df_MCPS %>%
  mutate(across("school_name", str_replace, "Col Zadok Magruder High School", "Colonel Zadok Magruder HS"))
df_MCPS<- 
  df_MCPS %>%
  mutate(across("school_name", str_replace, "Northwest High School", "Northwest HS - Germantown"))
df_MCPS<- 
  df_MCPS %>%
  mutate(across("school_name", str_replace, "Quince Orchard High School", "Quince Orchard Sr High School"))
df_MCPS<- 
  df_MCPS %>%
  mutate(across("school_name", str_replace, "Albert Einstein High School", "Albert Einstein HS & MC Art Cn"))
df_MCPS<- 
  df_MCPS %>%
  mutate(across("school_name", str_replace, "John F Kennedy High School", "John F. Kennedy High School"))
df_MCPS<- 
  df_MCPS %>%
  mutate(across("school_name", str_replace, "Springbrook High School", "Springbrook Sr High School"))



 
df_MCPS
```


```{r}


df_Degrees<- df_Degrees %>%
              mutate( MCPS = df_Degrees$high_school%in% df_MCPS$school_name)

df_Degrees%>%
  group_by(term_year,full_part)%>%
  filter(MCPS==TRUE)%>%
  count(high_school)
```


create highschool catergories: MCPS , Foreign, Homeschool, Out of State, Other MD ( private schools and MD public schools not in MCPS), DC( District of Columbia)

```{r}

df_Degrees<- df_Degrees%>%
              mutate(HS_classify= case_when(
                .$high_school == "** HOME SCHOOLED **" ~ "home_school", 
                .$high_school == "FOREIGN / INTERNATIONAL HS"~"Foreign",
                .$high_school == "G. E. D."~"GED",
                .$MCPS == TRUE~"MCPS",
                .$high_school=="DISTRICT OF COLUMBIA HS"~"DC",
                .$high_school == "Out of State High School"~"Out of State",
                TRUE~"Other In State"))
```




count number of MCPS graduates in cohort in term years 2020 and 2021
```{r}

df_Degrees%>%group_by(term_year,full_part) %>% 
        count(MCPS)

```

```{r}

df_Degrees%>%group_by(term_year,full_part) %>% 
        count(HS_classify)

```

Count of High Schools
```{r}
ggplot(data=df_Degrees, aes(x=HS_classify, fill=HS_classify)) +
      geom_bar() +
      geom_text(stat='count', aes(label=..count..), vjust=0,size=3)+
      facet_wrap(~term_year + full_part)+
      theme(axis.text.x=element_blank(),strip.background = element_blank(),panel.grid = element_blank())+
      ggtitle("High Schools Students' Graduated  ")+
      xlab("High School")+
      ylab("Frequency")


```
The majority of full time and part time students are from MCPS highschools


Proportion of Students from Highschools
```{r}
df_Degrees %>% 
    group_by(term_year,full_part) %>% 
    count(HS_classify) %>% 
    mutate(prop = n/sum(n)) %>% 
    ggplot(aes(x = HS_classify, y = prop)) +
    geom_col(aes(fill = HS_classify), position = "dodge") +
    geom_text(aes(label = scales::percent(prop,0.5), 
                  y = prop, 
                  group = HS_classify),
              position = position_dodge(width = 0.9),
              vjust = 0.25,size=3)+
    facet_wrap(~term_year + full_part)+
      ggtitle("High schools students graduated")+
      ylab('Proportion ')+
      xlab("")+
      theme(axis.text.x=element_blank(),strip.background = element_blank(),panel.grid = element_blank())
   

```
75.5% of full time degree students in term year 2020 and term year 2021 graduated from MCPS highschools.
58% of part time degree students in term year 2020 and 64% of part time students in term year 2021 graduated from MCPS highschool.

Breakdown of Highschools Full time students in term year 2020 attended in MCPS
```{r}
df_Degrees%>%
          filter(full_part=="FT" & term_year=="2020")%>%
          filter(HS_classify=="MCPS")%>%
          group_by(term_year,high_school)%>%
          count(high_school)%>%
          group_by(term_year)%>%
          mutate(total_pop =sum(n))%>%
          group_by(high_school)%>%
          arrange(term_year,.by_group=TRUE)%>%
          mutate(pct_pop= (n/total_pop*100))%>%
          arrange(desc(pct_pop))
  
```


The Graph below gives the overall proportions of full time students from highschools in MCPS in term_year 2020. As there are 25 highschools, I have not included the key.
The table above give the percentages of Full time students who attended each high school.
In term year 2020: 
7.93% of full time students finished high school at Gaithersburg High. 
6.32% from Montgomery Blair HS.
5.54% from Springbok Sr High School.
5.49% from Northwest HS - Germantown.
5.49% from Paint Branch High School.
9 highschools had a arrange between 4 and 5%
On the other end of the spectrum:
Walt Whitman High School at 1.13%.
Poolesville Jr-Sr High School 1.31%
Winston Churchill 2.03%
Thomas Sprigg Wootton High Sch 2.03%




```{r}
v1<- df_Degrees %>% 
    group_by(term_year,full_part) %>% 
    filter(full_part=="FT" & term_year=="2020")%>%
    filter(HS_classify=="MCPS")%>%
    count(high_school) %>% 
    mutate(prop = n/sum(n)) %>% 
    ggplot(aes(x = high_school, y = prop)) +
    geom_col(aes(fill=high_school), position = "dodge") +
    geom_text(aes(label = scales::percent(prop,0.5), 
                  y = prop, 
                  group = high_school),
              position = position_dodge(width = 0.9),
              vjust = 0, size=3, hjust=0)+
  #  facet_wrap(~term_year )+
      ggtitle("High schools full time students graduated in term year 2020 graduated")+
      ylab('Proportion ')+
      xlab("")+
      theme(legend.position = "none", axis.text.x=element_blank(),strip.background = element_blank(),panel.grid = element_blank()) 
  
v1+ coord_flip()  
```


Breakdown of Highschools Full time students in term year 2021 attended in MCPS
```{r}
df_Degrees%>%
          filter(full_part=="FT" & term_year=="2021")%>%
          filter(HS_classify=="MCPS")%>%
          group_by(term_year,high_school)%>%
          count(high_school)%>%
          group_by(term_year)%>%
          mutate(total_pop =sum(n))%>%
          group_by(high_school)%>%
          arrange(term_year,.by_group=TRUE)%>%
          mutate(pct_pop= (n/total_pop*100))%>%
          arrange(desc(pct_pop))

```

```{r}
v2<-df_Degrees %>% 
    group_by(term_year,full_part) %>% 
    filter(full_part=="FT" & term_year=="2021")%>%
    filter(HS_classify=="MCPS")%>%
    count(high_school) %>% 
    mutate(prop = n/sum(n)) %>% 
    ggplot(aes(x = high_school, y = prop)) +
    geom_col(aes(fill=high_school), position = "dodge") +
    geom_text(aes(label = scales::percent(prop,0.5), 
                  y = prop, 
                  group = high_school),
              position = position_dodge(width = 0.9),
              vjust = 0, size =3,hjust=0)+
  #  facet_wrap(~term_year )+
      ggtitle("High Schools Full time students in term year 2021 graduated")+
      ylab('Proportion ')+
      xlab("")+
      theme(legend.position = "none", axis.text.x=element_blank(),strip.background = element_blank(),panel.grid = element_blank()) 
  
v2+ coord_flip()   
```


```{r}
# calculate percentage change in full time student enrollment from 2020 to 2021 by MCPS highschool
df_Degrees%>%
          filter(full_part=="FT")%>%
          filter(HS_classify=="MCPS")%>%
          group_by(term_year,high_school)%>%
          count(high_school)%>%
          group_by(term_year)%>%
          group_by(high_school)%>%
          arrange(term_year,.by_group=TRUE)%>%
          mutate(pct_change= (n-lag(n))/lag(n)*100)
     
  
```

Full time students: Gaitherburg High had a 31.58% decrease in enrollment. Poolesville Jr-Sr High School 36.36% decrease. Springbrook Sr High School a 31.18% decrease.
Walter Johnson High School 28.38% decrease. Rockville High increased enrollment by 40.43%

A more detailed visualisation will be presented on Tableau in EDA.


Highs Schools Part time Students Graduated from. term year 2020 vs term year 2021

Part time students term year 2020: 
```{r}
q1<- df_Degrees %>% 
    group_by(term_year,full_part) %>% 
    filter(full_part=="PT" & term_year=="2020")%>%
    filter(HS_classify=="MCPS")%>%
    count(high_school) %>% 
    mutate(prop = n/sum(n)) %>% 
    ggplot(aes(x = high_school, y = prop)) +
    geom_col(aes(fill=high_school), position = "dodge") +
    geom_text(aes(label = scales::percent(prop,0.5), 
                  y = prop, 
                  group = high_school),
              position = position_dodge(width = 0.9),
              vjust = 0, size=3, hjust=0)+
  #  facet_wrap(~term_year )+
      ggtitle("High schools Part time students graduated in term year 2020 graduated")+
      ylab('Proportion ')+
      xlab("")+
      theme(legend.position = "none", axis.text.x=element_blank(),strip.background = element_blank(),panel.grid = element_blank()) 
  
q1+ coord_flip()  
```

Part time students term year 2021: 
```{r}
q2<- df_Degrees %>% 
    group_by(term_year,full_part) %>% 
    filter(full_part=="PT" & term_year=="2021")%>%
    filter(HS_classify=="MCPS")%>%
    count(high_school) %>% 
    mutate(prop = n/sum(n)) %>% 
    ggplot(aes(x = high_school, y = prop)) +
    geom_col(aes(fill=high_school), position = "dodge") +
    geom_text(aes(label = scales::percent(prop,0.5), 
                  y = prop, 
                  group = high_school),
              position = position_dodge(width = 0.9),
              vjust = 0, size=3, hjust=0)+
  #  facet_wrap(~term_year )+
      ggtitle("High schools Part time students graduated in term year 2020 graduated")+
      ylab('Proportion ')+
      xlab("")+
      theme(legend.position = "none", axis.text.x=element_blank(),strip.background = element_blank(),panel.grid = element_blank()) 
  
q2+ coord_flip()  
```
Breakdown of Highschools Part time students in term year 2020 attended in MCPS
```{r}
df_Degrees%>%
          filter(full_part=="PT" & term_year=="2020")%>%
          filter(HS_classify=="MCPS")%>%
          group_by(term_year,high_school)%>%
          count(high_school)%>%
          group_by(term_year)%>%
          mutate(total_pop =sum(n))%>%
          group_by(high_school)%>%
          arrange(term_year,.by_group=TRUE)%>%
          mutate(pct_pop= (n/total_pop*100))%>%
          arrange(desc(pct_pop))

```

Breakdown of Highschools Part time students in term year 2021 attended in MCPS
```{r}
df_Degrees%>%
          filter(full_part=="PT" & term_year=="2021")%>%
          filter(HS_classify=="MCPS")%>%
          group_by(term_year,high_school)%>%
          count(high_school)%>%
          group_by(term_year)%>%
          mutate(total_pop =sum(n))%>%
          group_by(high_school)%>%
          arrange(term_year,.by_group=TRUE)%>%
          mutate(pct_pop= (n/total_pop*100))%>%
          arrange(desc(pct_pop))

```


```{r}
# calculate percentage change in part time student enrollment from 2020 to 2021 by MCPS highschool
df_Degrees%>%
          filter(full_part=="PT")%>%
          filter(HS_classify=="MCPS")%>%
          group_by(term_year,high_school)%>%
          count(high_school)%>%
          group_by(term_year)%>%
          group_by(high_school)%>%
          arrange(term_year,.by_group=TRUE)%>%
          mutate(pct_change= (n-lag(n))/lag(n)*100)
     
```





### Majors

Overall Majors trend

Count of Majors in Full time students in 2020
```{r}
z1<- df_Degrees%>%
      filter(full_part=="FT" &term_year =="2020")%>%
       ggplot(., aes(x=major, fill=major)) +
      geom_bar() +
      geom_text(stat='count', aes(label=..count..), vjust=0, hjust=0, size =3)+
      ggtitle("Majors of Full-time Students in 2020  ")+
      xlab("Major")+
      ylab("Frequency")+
    theme(legend.position = "none") 
       
z1 + coord_flip()
```


Count of Majors in Full time students in 2021
```{r}
z13<- df_Degrees%>%
      filter(full_part=="FT" &term_year =="2021")%>%
       ggplot(., aes(x=major, fill=major)) +
      geom_bar() +
      geom_text(stat='count', aes(label=..count..), vjust=0, hjust=0, size =3)+
      ggtitle("Majors of Full-time Students in 2021  ")+
      xlab("Major")+
      ylab("Frequency")+
    theme(legend.position = "none") 
       
z13 + coord_flip()
```

calculate percentage change in full time student majors from 2020 to 2021 
```{r}
df_Degrees%>%
          filter(full_part=="FT")%>%
          group_by(term_year,major)%>%
          count(major)%>%
          group_by(term_year)%>%
          group_by(major)%>%
          arrange(term_year,.by_group=TRUE)%>%
          mutate(pct_change= (n-lag(n))/lag(n)*100)
```

Count of Majors in Part time students in 2020
```{r}
z11<- df_Degrees%>%
      filter(full_part=="PT" &term_year =="2020")%>%
       ggplot(., aes(x=major, fill=major)) +
      geom_bar() +
      geom_text(stat='count', aes(label=..count..), vjust=0, hjust=0, size =3)+
      ggtitle("Majors of Part-time Students in 2020  ")+
      xlab("Major")+
      ylab("Frequency")+
    theme(legend.position = "none") 
       
z11 + coord_flip()
```
Count of Majors in Part time students in 2021
```{r}
z12<- df_Degrees%>%
      filter(full_part=="PT" &term_year =="2021")%>%
       ggplot(., aes(x=major, fill=major)) +
      geom_bar() +
      geom_text(stat='count', aes(label=..count..), vjust=0, hjust=0, size =3)+
      ggtitle("Majors of Part-time Students in 2021  ")+
      xlab("Major")+
      ylab("Frequency")+
    theme(legend.position = "none") 
       
z12 + coord_flip()
```

calculate percentage change in part time student majors from 2020 to 2021 
```{r}
df_Degrees%>%
          filter(full_part=="PT")%>%
          group_by(term_year,major)%>%
          count(major)%>%
          group_by(term_year)%>%
          group_by(major)%>%
          arrange(term_year,.by_group=TRUE)%>%
          mutate(pct_change= (n-lag(n))/lag(n)*100)
```


## Registration in Summer School 1
Hours attempted in Summer 1 are reported with hours_attempted in Fall.
Credits earned in Summer 1 are usually reported with hours earned in Fall.
```{r}
#count number of full time versus part-time degree students.

df_Degrees%>% group_by(term_year,full_part)%>%
                     count(summer1=='Y')


```
There are 0 students who have attended Summer1. 
Hence values reported for hours_earned are only for credits earned in fall and AP credits.
Hours attempted in Fall are only for non credit developmental courses and credit courses taken in Fall.




## Hours Attempted by Degree Seeking Students

```{r}
# AP credits can be given for courses taken at highschool.
#Check number of students with hours_earned greater than hours_attempted

df_Degrees %>% count(hours_attempted<hours_earned)
```
There are 5 students with attempted hours smaller than hours earned. This may be due to AP credits ( credits earned in high school) and will be addressed later.


Histogram of hours_attempted by year
```{r}

p <- ggplot(df_Degrees, aes(x = hours_attempted))+ geom_histogram(aes(fill = term_year))
p1<- p + facet_wrap(~full_part)

p1
```


Boxplots of hours_attempted by year
```{r}
p11 = ggplot(df_Degrees, aes(hours_attempted))
p11 + geom_boxplot(aes(colour = term_year)) +
       facet_wrap(~full_part)
```

Density plot of hours_attempted by year
```{r}
ggplot(df_Degrees, aes(hours_attempted, fill = term_year)) + geom_density(alpha = 0.2) +
  facet_wrap(~full_part)+
  xlab("Hours attempted") +
  ylab( "Density")

```



Fivenum Summary
```{r}
df_Degrees%>% group_by(term_year,full_part)%>%
  summarise(n = n(),
            min = fivenum(hours_attempted)[1],
            Q1 = fivenum(hours_attempted)[2],
            median = fivenum(hours_attempted)[3],
            Q3 = fivenum(hours_attempted)[4],
            max = fivenum(hours_attempted)[5],
            mean= mean(hours_attempted),
            sd = sd(hours_attempted))


```



______Code not knitting

d1<-df_Degrees%>%
  filter(full_part=="FT")%>%
  filter(term_year=="2020")%>%
  dplyr::select(hours_attempted)

d2<-df_Degrees%>%
  filter(full_part=="FT")%>%
  filter(term_year=="2021")%>%
  dplyr::select(hours_attempted)

sband(d1,d2)
______

Hours Attempted by Full-time students: The distributions for the hours attempted by full time students in term year 2020 and term year 2021 have similar shapes.  The first quartile for both distributions is 12. The median for term year 2021 (14 hours attempted) is slightly higher than that in 2020 (13 hours attempted). The 3rd quartile for 2020 is 15, whilst in 2021 it is 16. Both distibutions are also skewed right and have similar tail lengths. The maxium for 2020 is 53 and in 2021 it is 54. The distribution for 2021 has lower peaks because there were less students enrolled in 2021 than in 2020. Peaks can be attributed to the fact that most courses are 3 or 4 credit courses. The college offers very few 2 credit courses. 

Hours Attempted by Part-time students: The distributions for the hours attempted by part time students in term year 2020 and term year 2021 have similar shapes. The first quartile in 2021 is 5 hours and is slightly lower than 2020 ( 6hours). Both distibutions are  skewed right. The right tail for 2021 is slightly shorter. The maxium for 2020 is 51 and in 2021 it is 47. The distribution for 2021 has lower peaks because there were less students enrolled in 2021 than in 2020. Peaks can be attributed to the fact that most courses are 3 or 4 credit courses. The college offers very few 2 credit courses.

Students who attempted less than 3 hours
```{r}

df_Degrees%>% group_by(term_year,full_part)%>%
                      count(hours_attempted<3)

```

Students who attempted more than 18hours
```{r}

df_Degrees%>% group_by(term_year,full_part)%>%
                      count(hours_attempted>18)

```


41 part time students attempted less than 3 hours in term year 2020 and 16 part time students attempted less than 3 hours in term year 2021.
Students also need special permission to enroll in more than 18 credits. In term year 2020, 327 full time and 56 part time students attempted more than 18 hours. In term year 2021, 290 full time and 47 part time degree seeking students attempted more than 18 hours.  As only a student who is registered for 12 or more credit hours is considered a full-time student.
Students classified as part time and enrolled in more than 12hours, are enrolled in less than 12 credit hours in the Fall semester. 
As non credit hours and credit hours are included in the hours attempted variable, I will use the hours earned variable to filter the datasets and remove outliers. 


## Hours Earned by Degree Seeking Students

Histogram of hours_earned by year
```{r}

p <- ggplot(df_Degrees, aes(x = hours_earned))+ geom_histogram(aes(fill = term_year))
p1<- p + facet_wrap(~full_part)

p1
```
Boxplots of hours_earned by year
```{r}
p11 = ggplot(df_Degrees, aes(hours_earned))
p11 + geom_boxplot(aes(colour = term_year)) +
       facet_wrap(~full_part)


```


Density plot of hours_earned by year
```{r}
ggplot(df_Degrees, aes(hours_earned, fill = term_year)) + geom_density(alpha = 0.2) +
  facet_wrap(~full_part)+
  xlab("Hours Earned") +
  ylab( "Density")
  
```
Hours Earned Fivenum Summary
```{r}
df_Degrees%>% group_by(term_year,full_part)%>%
  summarise(n = n(),
            min = fivenum(hours_earned)[1],
            Q1 = fivenum(hours_earned)[2],
            median = fivenum(hours_earned)[3],
            Q3 = fivenum(hours_earned)[4],
            max = fivenum(hours_earned)[5],
            mean= mean(hours_earned),
            sd = sd(hours_earned))


```

QQplot of hours earned by Fulltime Students.
```{r}

d1<- df_Degrees%>%filter(full_part=="FT")

p<-qplot(sample = hours_earned, data = d1, color=term_year)
p
```



Hours Earned Summary
The distributions appeared to be skewed to the right. Incoming students are allowed to get AP credits for courses taken at highschool.
The distributions for part-time student in 2020 and 2021 appear to follow a similar distribution. Peaks can be attributed to the fact that most courses are 3 or 4 credit courses. The college offers very few 2 credit courses. Students also need special permission to enroll in more than 18credits. 
Fulltime Students: The first quartile in term year 2020 and term year 2021 is 6 credits. The median for term year 2021 ( 10 hours earned) is slightly higher than the median in 2020 ( 9 hours earned). Both distributions has long tails on the right, with 2020 havinga maximum of 53 and 2021 having a maxium of 54. 
Part time Students: Both 2020 and 2021 follow a similar distribution. The first quartile for both years is 0. This means that 25% of part time students earn 0 credits. 
The median for both distributions is 3, ie. 50% of students earn up to 3 credits. The 3rd quartile for both distributions is 6. Both distributions have long tails.

Students who earned less than 3 hours
```{r}

df_Degrees%>% group_by(term_year,full_part)%>%
                      count(hours_earned<3)

```

Hours earned equate to credits earned and is the indication of the progress a student is making towards a degree.
In term year 2020, 240 full time and 727 part time students earned less than 3 credits.
In term year 2021, 290 full time and 504 part time earned less than 3 credits.

Students who earned more than 18 credits
```{r}

df_Degrees%>% group_by(term_year,full_part)%>%
                      count(hours_earned>18)

```


## Create New Variable hours_earned_rate
```{r}
# create variable pass_earned_hours
# hours_earned_rate = hours_earned/hours_attempted

df_Degrees<-df_Degrees %>%
           mutate(hours_earned_rate=hours_earned/hours_attempted)

```

Density plot of Hours Earned Rate by year
```{r}
ggplot(df_Degrees, aes(hours_earned_rate, fill = term_year)) + geom_density(alpha = 0.3) +
  facet_wrap(~full_part)+
  xlab("Hours Earned Rate") +
  ylab( "Density")+
  xlim(0,1)
```


## Create New Variable unearned_hours
Unearned hours are attempted hours that the student did not receive credit for. 
```{r}

df_Degrees<-df_Degrees %>%
           mutate(unearned_hours = hours_attempted-hours_earned)


```

Density plot of unearned hours per a year
```{r}
ggplot(df_Degrees, aes(unearned_hours, fill = term_year)) + geom_density(alpha = 0.3) +
  facet_wrap(~full_part)+
  xlab("Unearned hours") +
  ylab( "Density") +
  xlim (0,18)
```


## GPA 
Histogram of GPA by year
```{r}

p <- ggplot(df_Degrees, aes(x = mc_gpa))+ geom_histogram(aes(fill = term_year))
p7<- p + facet_wrap(~full_part)

p7
```

Boxplots of GPA by year
```{r}
p15 = ggplot(df_Degrees, aes(mc_gpa))
p15 + geom_boxplot(aes(colour = term_year)) +
       facet_wrap(~full_part)
```

Density plot of GPA by year
```{r}
ggplot(df_Degrees, aes(mc_gpa, fill = term_year)) + geom_density(alpha = 0.2) +
  facet_wrap(~full_part)+
  xlab("GPA") +
  ylab( "Density")

```

GPA Fivenum Summary
```{r}
df_Degrees%>% group_by(term_year,full_part)%>%
  summarise(n = n(),
            min = fivenum(mc_gpa)[1],
            Q1 = fivenum(mc_gpa)[2],
            median = fivenum(mc_gpa)[3],
            Q3 = fivenum(mc_gpa)[4],
            max = fivenum(mc_gpa)[5],
            mean= mean(mc_gpa),
            sd = sd(mc_gpa))


```



## Distribution of Variables and Correlation 
```{r,message=FALSE}

library(GGally)
# plot distributions and correlation of variables
df_Degrees%>% filter(term_year=="2020")%>%
              filter(full_part=="FT")%>%
              ggpairs(., columns = c("hours_attempted","hours_earned", "mc_gpa","hours_earned_rate","unearned_hours"))

```


------
Save data Frames for statistical analysis.
```{r}
write_csv(df_Degrees,"Degrees_Data.csv")

```

