---
title: "PartB"
author: "Ulita Gilbert"
date: "05/03/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#import libraries

library(tidyverse)
library(ggplot2)
library(readxl)
library (janitor)
library(skimr)
```

# Import Data
```{r}
#import data for Fall 2016 to Fall 2020
# set directory
setwd('/Users/ulita/Documents/CAPSTONE205/Capstone/Capstone_Data/Raw_Data')

df_2019<-read_xlsx("FTEIC F19.xlsx")
df_2020<-read_xlsx("FTEIC F20.xlsx")


```



# Create Dataframe
```{r}
 #create dataframe to compare credits in Fall 2019 and Fall 2020 :    df_credits 
df_credits<- bind_rows(df_2019,df_2020)
```

# Clean Data
```{r}

#clean names using janitor package
df_credits<-df_credits %>%
              clean_names()

#drop columns not interested in

df_credits<-df_credits %>%
             select(c(1:18))
  
# rename columns to make it user friendly
df_credits<-df_credits %>%
            rename("age"= "age_at_start", "race"= "ipeds_race_desc")


```

# Summary of data

```{r}

str(df_credits)
dim(df_credits)

```


## Statistical Summary of Variables
```{r}
# summary statistics of dataframing using function skimr creates a table of summary statistics of all variables in the dataframe
skim(df_credits)
```

There are 18 variables and 7519 rows of data.Need to change the data types for hours_attempted and hours_earned to numeric. u_number should be a charater. 
Most of the missing values are in camp_code. For the purposes of this exercise, this variable is not important.
There are also 87 missing values in hours attempted and hours earned. As these two are the variables of interest and GPA are of interest, I will drop the rows in these variables with missing values.

```{r}
# Change datatypes
df_credits$hours_attempted<- as.integer(df_credits$hours_attempted)
df_credits$hours_earned<- as.integer(df_credits$hours_earned)
df_credits$mc_gpa<- as.double(df_credits$mc_gpa)
df_credits$u_number<- as.character(df_credits$u_number)
df_credits$zip<- as.character(df_credits$zip)

#drop missing values in hours_attempted, hours_earned and mc_gap

df_credits <- df_credits %>%
              drop_na(hours_attempted,hours_earned)

```

Summarise data again
```{r}
skim(df_credits)
```

```{r}
# Check number of students who attempted 0 credits i.e  hours_attempted =0

df_credits %>% count(hours_attempted==0)
  

```
47 students attempted zero hours. These 47 observations will be dropped.

```{r}
# check data for consistency. Hours earned cannot be greater than hours attempted.

df_credits %>% count(hours_attempted<hours_earned)
```
There are 5 strange datapoints with hours_earned greater than hours_attempted. Drop these 5 data points.


```{r}

df_credits <- df_credits%>%
              filter(., hours_attempted != 0)

df_credits <- df_credits%>%
              filter(., hours_attempted >= hours_earned)
              
skim(df_credits)

```
There are now 18 variables with 7380 rows

```{r}
# Number of Full time versus Part time student by year

df_credits %>% group_by(term_year, full_part) %>%
  summarise(n=n())
  


```
In term year 2020( Fall 2019), there were 2251 full time and 1606 part-time students
In term year 2021 (Fall 2020), there were 2147 full time and 1376 part time students.

# EDA questions:

1. Did incoming students in Fall 2020 attempt more or less credits than in Fall 2019?
2. Did students have a higher pass or failure rate in Fall 2020 when compared to Fall 2019 ( hours earned/hours attempted versus  in Fall 2019  semester compared to Fall 2020).



## Question 1

Boxplots of hours_attempted by year
```{r}
p = ggplot(df_credits, aes(hours_attempted))
p + geom_boxplot(aes(colour = term_year))
```


Histogram of hours_attempted by year
```{r}

p <- ggplot(df_credits, aes(x = hours_attempted))+ geom_histogram()
p1<- p + facet_wrap(~term_year)

p1
```

Density plot of hours_attempted by year
```{r}
ggplot(df_credits, aes(hours_attempted, fill = term_year)) + geom_density(alpha = 0.2) +
  xlab("Hours attempted") +
  ylab( "Density")

```



# Question 2

Boxplots of hours_earned by year
```{r}
p = ggplot(df_credits, aes(hours_attempted))
p + geom_boxplot(aes(colour = term_year))
```

Histogram of hours_earned by year
```{r}

q <- ggplot(df_credits, aes(x = hours_earned))+ geom_histogram()
q1<- q + facet_wrap(~term_year)

q1
```

Density plot of hours_earned by year
```{r}
ggplot(df_credits, aes(hours_earned, fill = term_year)) + geom_density(alpha = 0.2) +
  xlab("Hours Earned") +
  ylab( "Density")
```

Calculate the Pass Rate of hours_attempted.
```{r}
# create variable pass_rate_hours
# pass_rate_hours = hours_earned/hours_attempted

df_credits<-df_credits %>%
           mutate(hours_pass_rate=hours_earned/hours_attempted)

```


Boxplots of pass_rate_hours by year
```{r}
p3 = ggplot(df_credits, aes(hours_pass_rate))
p3 + geom_boxplot(aes(colour = term_year))
```

Histogram of hours_pass_rate by year
```{r}

q7 <- ggplot(df_credits, aes(x = hours_pass_rate))+ geom_histogram()
q8<- q7 + facet_wrap(~term_year)

q8
```


Density plot of hours_pass_rate by year
```{r}
ggplot(df_credits, aes(hours_pass_rate, fill = term_year)) + geom_density(alpha = 0.2) +
  xlab("Hours Earned") +
  ylab( "Density")
```

#  Full time vs Part Time Students: Hours Pass Rate 

Density plot of hours_pass_rate by year
```{r}
ggplot(df_credits, aes(hours_pass_rate, fill = term_year)) + geom_density(alpha = 0.2) +
  facet_wrap(~full_part)+
  xlab("Hours Pass Rate") +
  ylab( "Density")
```

#  Degree Seeking Students 

 
```{r}

#check majors list for undeclared and missing values.

df_credits%>% count(major)

```

There are 33 undeclared majors. 16 majors listed as 0 and 33 listed as NA.
I will remove these undeclared majors, and majors listed as NA and 0. 

```{r}
# remove majors listed as "0" and "Undeclared'
df_creditsMajors<- df_credits %>% 
                    filter(major!="0") %>%
                    filter(major!='Undeclared')

#remove NA data 

df_creditsMajors<-df_creditsMajors%>% drop_na(major)

df_creditsMajors%>% count(major)

dim(df_creditsMajors)
```
There are now 20 variables and 7259 rows of data. There are 220 Certificate & LR students. I will drop these non-degree programmes
and focus on degree majors.


```{r}
# create dataframe with degrees only.

df_creditsDegrees<- df_creditsMajors %>%
                    filter(major !="Certificate & LR")

df_creditsDegrees%>% count(major)
dim(df_creditsDegrees)
```

There are 7039 rows of data and 19 variables in the dataframe df_creditsDegrees.

```{r}
#count number of full time versus part-time degree students.

df_creditsDegrees%>% group_by(term_year)%>%
                     count(full_part)


```
Degree Seeking students:
In term year 2020, there were 2213 full time and 1484 part time students in the Fall 2019 freshman cohort.
In term year 2021, there were 2071 full time and 1270 part time students in the Fall 2020 frehsman cohort.
This is a 6.5% reduction in fulltime enrollment and a 14.4% reduction in part-time enrollment.

## Hours Attempted

Boxplots of hours_attempted by year
```{r}
p11 = ggplot(df_creditsDegrees, aes(hours_attempted))
p11 + geom_boxplot(aes(colour = term_year)) +
       facet_wrap(~full_part)
```

Density plot of hours_attempted by year
```{r}
ggplot(df_creditsDegrees, aes(hours_attempted, fill = term_year)) + geom_density(alpha = 0.2) +
  facet_wrap(~full_part)+
  xlab("Hours attempted") +
  ylab( "Density")

```


Density plot of hours_earned by year
```{r}
ggplot(df_credits, aes(hours_earned, fill = term_year)) + geom_density(alpha = 0.2) +
  facet_wrap(~full_part)+
  xlab("Hours Earned") +
  ylab( "Density")
  
```


## Hours Pass Rate

Density plot of hours_pass_rate by year
```{r}
ggplot(df_creditsDegrees, aes(hours_pass_rate, fill = term_year)) + geom_density(alpha = 0.2) +
  facet_wrap(~full_part)+
  xlab("Hours Pass Rate") +
  ylab( "Density")
```

Boxplots of pass_rate_hours by year
```{r}
p7 = ggplot(df_creditsDegrees, aes(hours_pass_rate))
p7 + geom_boxplot(aes(colour = term_year)) +
    facet_wrap(~full_part)
```
