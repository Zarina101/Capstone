---
title: "PartB"
author: "Ulita Gilbert"
date: "05/03/2021"
output: 
  html_document: 
    fig_caption: yes
    number_sections: yes
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#import libraries

library(tidyverse)
library(ggplot2)
library(readxl)
library (janitor)
library(skimr)
```

# Data Dictionary

For the purposes of this EDA, the following variables and definitions are important.

The population in this dataset is the incoming cohort of students in Fall each year. These students are first time degree or certificate seekers and have no prior
tertiary education.

**Fall2019** refers to the incoming freshman cohort in Fall2019. This is also term year 2020.  
**Fall2020** refers to the incoming freshman cohort in Fall2020. This is term year 2021.  

**Variables of Interest:**  
**hours_earned:** refers to credits the student has earned in their first Fall semester ( this can include credits earned in Summer school second session- Summer 1).  
**hours_attempted:** refers to credits the student has attempted in their first Fall semester  ( this can include credits attempted in Summerschool second session - Summer 1).  

**full_part:** is the student full-time (FT) or part-time (PT)  

**major:** degree programme student is registered for or certificate&LR ( letter of recommendation.) All certificates and letters of recommendations have been grouped together.   

**hours_pass_rate:** Ratio of hours_earned/hours_attempted  


# Import Data
```{r}
#import data for Fall 2016 to Fall 2020
# set directory
setwd('/Users/ulita/Documents/CAPSTONE205/Capstone/Capstone_Data/Raw_Data')

df_2019<-read_xlsx("FTEIC F19.xlsx")
df_2020<-read_xlsx("FTEIC F20.xlsx")

```



# Create Dataframe
```{r}
 #create dataframe to compare credits in Fall 2019 and Fall 2020 :    df_credits 
df_credits<- bind_rows(df_2019,df_2020)

head(df_credits)
```


# Data Wrangling

## Select Columns of Interest & Format Names
```{r}

#clean names using janitor package
df_credits<-df_credits %>%
              clean_names()

#drop columns not interested in

df_credits<-df_credits %>%
             select(c(1:18))
  
# rename columns to make it user friendly
df_credits<-df_credits %>%
            rename("age"= "age_at_start", "race"= "ipeds_race_desc")


```

## Statistical Summary of Data
```{r}
# summary statistics of dataframing using function skimr creates a table of summary statistics of all variables in the dataframe
skim(df_credits)
```

There are 18 variables and 7519 rows of data.Need to change the data types for hours_attempted and hours_earned to numeric. u_number should be a charater. 
Most of the missing values are in camp_code. For the purposes of this exercise, this variable is not important.
There are also 87 missing values in hours attempted and hours earned. As these two are the variables of interest and GPA are of interest, I will drop the rows in these variables with missing values.

## Change Datatypes
```{r}
# Change datatypes
df_credits$hours_attempted<- as.integer(df_credits$hours_attempted)
df_credits$hours_earned<- as.integer(df_credits$hours_earned)
df_credits$mc_gpa<- as.double(df_credits$mc_gpa)
df_credits$u_number<- as.character(df_credits$u_number)
df_credits$zip<- as.character(df_credits$zip)

#drop missing values in hours_attempted, hours_earned and mc_gap

df_credits <- df_credits %>%
              drop_na(hours_attempted,hours_earned)

```

Summarise data again
```{r}
skim(df_credits)
```

## Missing Values
```{r}
# Check number of students who attempted 0 credits i.e  hours_attempted =0

df_credits %>% count(hours_attempted==0)
  

```
47 students attempted zero hours. These 47 observations will be dropped.

```{r}
# check data for consistency. Hours earned cannot be greater than hours attempted.

df_credits %>% count(hours_attempted<hours_earned)
```
There are 5 strange datapoints with hours_earned greater than hours_attempted. Drop these 5 data points.


```{r}
# remove inconsistent data points. Hours earned cannot be bigger than hours attempted

df_credits <- df_credits%>%
              filter(., hours_attempted != 0)

df_credits <- df_credits%>%
              filter(., hours_attempted >= hours_earned)
              
skim(df_credits)

```
There are now 18 variables with 7380 rows

## Full time versus Part-time students
```{r}
# Number of Full time versus Part time student by year

df_credits %>% group_by(term_year, full_part) %>%
  summarise(n=n())
  


```
In term year 2020( Fall 2019), there were 2251 full time and 1606 part-time students
In term year 2021 (Fall 2020), there were 2147 full time and 1376 part time students.



## Create New Variable pass_rate_hours
```{r}
# create variable pass_rate_hours
# pass_rate_hours = hours_earned/hours_attempted

df_credits<-df_credits %>%
           mutate(hours_pass_rate=hours_earned/hours_attempted)

```


## Degree Seeking Students 

Create dataframe for degree seeking students only 
```{r}

#check majors list for undeclared and missing values.

df_credits%>% count(major)

```

There are 33 undeclared majors. 16 majors listed as 0 and 33 listed as NA.
I will remove these undeclared majors, and majors listed as NA and 0. 

```{r}
# remove majors listed as "0" and "Undeclared'
df_creditsMajors<- df_credits %>% 
                    filter(major!="0") %>%
                    filter(major!='Undeclared')

#remove NA data 

df_creditsMajors<-df_creditsMajors%>% drop_na(major)

df_creditsMajors%>% count(major)

dim(df_creditsMajors)
```
There are now 20 variables and 7259 rows of data. There are 220 Certificate & LR students. I will drop these non-degree programmes
and focus on degree majors.


```{r}
# create dataframe with degrees only.

df_creditsDegrees<- df_creditsMajors %>%
                    filter(major !="Certificate & LR")

df_creditsDegrees%>% count(major)
dim(df_creditsDegrees)
```

There are 7039 rows of data and 19 variables in the dataframe df_creditsDegrees.

```{r}
#count number of full time versus part-time degree students.

df_creditsDegrees%>% group_by(term_year)%>%
                     count(full_part)


```
Degree Seeking students:
In term year 2020, there were 2213 full time and 1484 part time students in the Fall 2019 freshman cohort.
In term year 2021, there were 2071 full time and 1270 part time students in the Fall 2020 freshman cohort.
This is a 6.5% reduction in fulltime enrollment and a 14.4% reduction in part-time enrollment.

# EDA questions:

1. Did degree seeking students in the Fall 2020 (term_year 2020) cohort attempt more or less credits(hours_attempted) than the Fall 2019 (term_year 2021) cohort?
2. Did degree seeking students in the Fall 2020 cohort earn more or less credits (hours_earned) than the Fall 2019 cohort? 
3. Did degree seeking students in the Fall 2020 cohort have a higher pass or failure rate than the Fall 2019 cohort (hours_pass_rate= hours_earned/hours_attempted)


## Question 1: Hours Attempted

Histogram of hours_attempted by year
```{r}

p <- ggplot(df_creditsDegrees, aes(x = hours_attempted))+ geom_histogram(aes(fill = term_year))
p1<- p + facet_wrap(~full_part)

p1
```


Boxplots of hours_attempted by year
```{r}
p11 = ggplot(df_creditsDegrees, aes(hours_attempted))
p11 + geom_boxplot(aes(colour = term_year)) +
       facet_wrap(~full_part)
```

Density plot of hours_attempted by year
```{r}
ggplot(df_creditsDegrees, aes(hours_attempted, fill = term_year)) + geom_density(alpha = 0.2) +
  facet_wrap(~full_part)+
  xlab("Hours attempted") +
  ylab( "Density")

```

## Question 2 : Hours Earned

Histogram of hours_earned by year
```{r}

p <- ggplot(df_creditsDegrees, aes(x = hours_earned))+ geom_histogram(aes(fill = term_year))
p1<- p + facet_wrap(~full_part)

p1
```
Boxplots of hours_earned by year
```{r}
p11 = ggplot(df_creditsDegrees, aes(hours_earned))
p11 + geom_boxplot(aes(colour = term_year)) +
       facet_wrap(~full_part)
```


Density plot of hours_earned by year
```{r}
ggplot(df_credits, aes(hours_earned, fill = term_year)) + geom_density(alpha = 0.2) +
  facet_wrap(~full_part)+
  xlab("Hours Earned") +
  ylab( "Density")
  
```

## Question 3: Hours Pass Rate

Histogram of Hours Pass Rate by year
```{r}

p <- ggplot(df_creditsDegrees, aes(x = hours_pass_rate))+ geom_histogram(aes(fill = term_year))
p1<- p + facet_wrap(~full_part)

p1
```

Boxplots of Hours Pass Rate by year
```{r}
p7 = ggplot(df_creditsDegrees, aes(hours_pass_rate))
p7 + geom_boxplot(aes(colour = term_year)) +
    facet_wrap(~full_part)
```


Density plot of Hours Pass Rate by year
```{r}
ggplot(df_creditsDegrees, aes(hours_pass_rate, fill = term_year)) + geom_density(alpha = 0.2) +
  facet_wrap(~full_part)+
  xlab("Hours Pass Rate") +
  ylab( "Density")
```

